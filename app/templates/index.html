<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <title>Test API Odyseusz</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
  <h1>Test Odyseusz</h1>

  <h2>Dodaj Podróżnego</h2>
  <form id="travelerForm">
    <input type="text" name="pesel" placeholder="PESEL" required>
    <input type="text" name="first_name" placeholder="Imię" required>
    <input type="text" name="last_name" placeholder="Nazwisko" required>
    <input type="email" name="email" placeholder="Email" required>
    <input type="text" name="login" placeholder="Login" required>
    <input type="password" name="password" placeholder="Hasło" required>
    <button type="submit">Dodaj</button>
  </form>
  <pre id="travelerResult"></pre>

  <h2>Lista Podróżnych</h2>
  <button id="getTravelers">Pobierz</button>
  <pre id="travelerList"></pre>

  <h2>Dodaj Kraj</h2>
  <form id="countryForm">
    <input type="text" name="name" placeholder="Nazwa kraju" required>
    <button type="submit">Dodaj</button>
  </form>
  <pre id="countryResult"></pre>

  <h2>Dodaj Miasto</h2>
  <form id="cityForm">
    <input type="text" name="name" placeholder="Nazwa miasta" required>
    <input type="number" name="country_id" placeholder="ID kraju" required>
    <button type="submit">Dodaj</button>
  </form>
  <pre id="cityResult"></pre>

  <h2>Pobierz Kraj z Miastami</h2>
  <input type="number" id="getCountryId" placeholder="ID kraju">
  <button id="getCountryBtn">Pobierz</button>
  <pre id="countryWithCities"></pre>

  <h2>Dodaj Podróż</h2>
  <form id="tripForm">
    <input type="text" name="status" placeholder="Status" required>
    <input type="text" name="traveler_pesel" placeholder="PESEL podróżnika" required>
    <button type="submit">Dodaj</button>
  </form>
  <pre id="tripResult"></pre>

  <h2>Pobierz Podróże Podróżnika</h2>
  <input type="text" id="getTripsPesel" placeholder="PESEL">
  <button id="getTripsBtn">Pobierz</button>
  <pre id="tripsList"></pre>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const apiBase = "http://localhost:5000"; // zmień jeśli backend działa na innym porcie lub domenie

      // === DODAJ PODRÓŻNEGO ===
      document.getElementById("travelerForm").addEventListener("submit", async (e) => {
        e.preventDefault();
        const formData = Object.fromEntries(new FormData(e.target).entries());
        const res = await fetch(`${apiBase}/travelers`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(formData)
        });
        document.getElementById("travelerResult").textContent = await res.text();
      });

      // === POBIERZ LISTĘ PODRÓŻNYCH ===
      document.getElementById("getTravelers").addEventListener("click", async () => {
        const res = await fetch(`${apiBase}/travelers`);
        document.getElementById("travelerList").textContent = await res.text();
      });

      // === DODAJ KRAJ ===
      document.getElementById("countryForm").addEventListener("submit", async (e) => {
        e.preventDefault();
        const formData = Object.fromEntries(new FormData(e.target).entries());
        const res = await fetch(`${apiBase}/countries`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(formData)
        });
        document.getElementById("countryResult").textContent = await res.text();
      });

      // === DODAJ MIASTO ===
      document.getElementById("cityForm").addEventListener("submit", async (e) => {
        e.preventDefault();
        const formData = Object.fromEntries(new FormData(e.target).entries());
        formData.country_id = parseInt(formData.country_id);
        const res = await fetch(`${apiBase}/cities`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(formData)
        });
        document.getElementById("cityResult").textContent = await res.text();
      });

      // === POBIERZ KRAJ Z MIASTAMI ===
      document.getElementById("getCountryBtn").addEventListener("click", async () => {
        const id = document.getElementById("getCountryId").value;
        if (!id) return alert("Podaj ID kraju");
        const res = await fetch(`${apiBase}/countries/${id}`);
        document.getElementById("countryWithCities").textContent = await res.text();
      });

      // === DODAJ PODRÓŻ ===
      document.getElementById("tripForm").addEventListener("submit", async (e) => {
        e.preventDefault();
        const formData = Object.fromEntries(new FormData(e.target).entries());
        const res = await fetch(`${apiBase}/trips`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(formData)
        });
        document.getElementById("tripResult").textContent = await res.text();
      });

      // === POBIERZ PODRÓŻE PODRÓŻNIKA ===
      document.getElementById("getTripsBtn").addEventListener("click", async () => {
        const pesel = document.getElementById("getTripsPesel").value;
        if (!pesel) return alert("Podaj PESEL");
        const res = await fetch(`${apiBase}/travelers/${pesel}/trips`);
        document.getElementById("tripsList").textContent = await res.text();
      });
    });
  </script>
</body>
</html>
